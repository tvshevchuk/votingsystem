angular.module("mafia",["ui.router"]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(t,r,e){e.otherwise("/"),r.state("start",{url:"/",views:{header:{templateUrl:"start/startHeader/startHeader.tpl.html",controller:"StartHeaderController",controllerAs:"startHeaderCtrl"},content:{templateUrl:"common/rating/ratingContent.tpl.html",controller:"RatingController",controllerAs:"ratingCtrl"}}}).state("profile",{"abstract":!0,url:"/profile",views:{header:{templateUrl:"profile/mainHeader/mainHeader.tpl.html",controller:"MainHeaderController",controllerAs:"mainHeaderCtrl"}}}).state("profile.voting",{url:"/voting",views:{"content@":{templateUrl:"profile/voting/votingContent.tpl.html",controller:"VotingController",controllerAs:"votingCtrl"}}}).state("profile.rating",{url:"/rating",views:{"content@":{templateUrl:"common/rating/ratingContent.tpl.html",controller:"RatingController",controllerAs:"ratingCtrl"}}}).state("profile.myrating",{url:"/myrating",views:{"content@":{templateUrl:"profile/myRating/myRating.tpl.html",controller:"MyRatingController",controllerAs:"myRatingCtrl"}}}).state("admin",{url:"/admin",views:{content:{templateUrl:"admin/admin.html",controller:"AdminController"}}})}]).value("UserValue",{}).run(["$window","$rootScope","$state","UserValue",function(t,r,e,n){t.app=function(t){r.$apply(function(){angular.extend(n,t),r.$emit("successLogin")})},r.$on("successLogin",function(){e.go("profile.rating")})}]),angular.module("mafia",["ui.router"]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(t,r,e){e.otherwise("/"),r.state("start",{url:"/",views:{header:{templateUrl:"start/startHeader/startHeader.tpl.html",controller:"StartHeaderController",controllerAs:"startHeaderCtrl"},content:{templateUrl:"common/rating/ratingContent.tpl.html",controller:"RatingController",controllerAs:"ratingCtrl"}}}).state("profile",{"abstract":!0,url:"/profile",views:{header:{templateUrl:"profile/mainHeader/mainHeader.tpl.html",controller:"MainHeaderController",controllerAs:"mainHeaderCtrl"}}}).state("profile.voting",{url:"/voting",views:{"content@":{templateUrl:"profile/voting/votingContent.tpl.html",controller:"VotingController",controllerAs:"votingCtrl"}}}).state("profile.rating",{url:"/rating",views:{"content@":{templateUrl:"common/rating/ratingContent.tpl.html",controller:"RatingController",controllerAs:"ratingCtrl"}}}).state("profile.myrating",{url:"/myrating",views:{"content@":{templateUrl:"profile/myRating/myRating.tpl.html",controller:"MyRatingController",controllerAs:"myRatingCtrl"}}}).state("admin",{url:"/admin",views:{content:{templateUrl:"admin/admin.html",controller:"AdminController"}}})}]).value("UserValue",{}).run(["$window","$rootScope","$state","UserValue",function(t,r,e,n){t.app=function(t){r.$apply(function(){angular.extend(n,t),r.$emit("successLogin")})},r.$on("successLogin",function(){e.go("profile.rating")})}]),angular.module("mafia",["ui.router"]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(t,r,e){e.otherwise("/"),r.state("start",{url:"/",views:{header:{templateUrl:"start/startHeader/startHeader.tpl.html",controller:"StartHeaderController",controllerAs:"startHeaderCtrl"},content:{templateUrl:"common/rating/ratingContent.tpl.html",controller:"RatingController",controllerAs:"ratingCtrl"}}}).state("profile",{"abstract":!0,url:"/profile",views:{header:{templateUrl:"profile/mainHeader/mainHeader.tpl.html",controller:"MainHeaderController",controllerAs:"mainHeaderCtrl"}}}).state("profile.voting",{url:"/voting",views:{"content@":{templateUrl:"profile/voting/votingContent.tpl.html",controller:"VotingController",controllerAs:"votingCtrl"}}}).state("profile.rating",{url:"/rating",views:{"content@":{templateUrl:"common/rating/ratingContent.tpl.html",controller:"RatingController",controllerAs:"ratingCtrl"}}}).state("profile.myrating",{url:"/myrating",views:{"content@":{templateUrl:"profile/myRating/myRating.tpl.html",controller:"MyRatingController",controllerAs:"myRatingCtrl"}}}).state("admin",{url:"/admin",views:{content:{templateUrl:"admin/admin.html",controller:"AdminController"}}})}]).value("UserValue",{}).run(["$window","$rootScope","$state","UserValue",function(t,r,e,n){t.app=function(t){r.$apply(function(){angular.extend(n,t),r.$emit("successLogin")})},r.$on("successLogin",function(){e.go("profile.rating")})}]),angular.module("mafia",["ui.router"]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(t,r,e){e.otherwise("/"),r.state("start",{url:"/",views:{header:{templateUrl:"start/startHeader/startHeader.tpl.html",controller:"StartHeaderController",controllerAs:"startHeaderCtrl"},content:{templateUrl:"common/rating/ratingContent.tpl.html",controller:"RatingController",controllerAs:"ratingCtrl"}}}).state("profile",{"abstract":!0,url:"/profile",views:{header:{templateUrl:"profile/mainHeader/mainHeader.tpl.html",controller:"MainHeaderController",controllerAs:"mainHeaderCtrl"}}}).state("profile.voting",{url:"/voting",views:{"content@":{templateUrl:"profile/voting/votingContent.tpl.html",controller:"VotingController",controllerAs:"votingCtrl"}}}).state("profile.rating",{url:"/rating",views:{"content@":{templateUrl:"common/rating/ratingContent.tpl.html",controller:"RatingController",controllerAs:"ratingCtrl"}}}).state("profile.myrating",{url:"/myrating",views:{"content@":{templateUrl:"profile/myRating/myRating.tpl.html",controller:"MyRatingController",controllerAs:"myRatingCtrl"}}}).state("admin",{url:"/admin",views:{content:{templateUrl:"admin/admin.html",controller:"AdminController"}}})}]).value("UserValue",{}).run(["$window","$rootScope","$state","UserValue",function(t,r,e,n){t.app=function(t){r.$apply(function(){angular.extend(n,t),r.$emit("successLogin")})},r.$on("successLogin",function(){e.go("profile.rating")})}]),angular.module("mafia",["ui.router"]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(t,r,e){e.otherwise("/"),r.state("start",{url:"/",views:{header:{templateUrl:"start/startHeader/startHeader.tpl.html",controller:"StartHeaderController",controllerAs:"startHeaderCtrl"},content:{templateUrl:"common/rating/ratingContent.tpl.html",controller:"RatingController",controllerAs:"ratingCtrl"}}}).state("profile",{"abstract":!0,url:"/profile",views:{header:{templateUrl:"profile/mainHeader/mainHeader.tpl.html",controller:"MainHeaderController",controllerAs:"mainHeaderCtrl"}}}).state("profile.voting",{url:"/voting",views:{"content@":{templateUrl:"profile/voting/votingContent.tpl.html",controller:"VotingController",controllerAs:"votingCtrl"}}}).state("profile.rating",{url:"/rating",views:{"content@":{templateUrl:"common/rating/ratingContent.tpl.html",controller:"RatingController",controllerAs:"ratingCtrl"}}}).state("profile.myrating",{url:"/myrating",views:{"content@":{templateUrl:"profile/myRating/myRating.tpl.html",controller:"MyRatingController",controllerAs:"myRatingCtrl"}}}).state("admin",{url:"/admin",views:{content:{templateUrl:"admin/admin.html",controller:"AdminController"}}})}]).value("UserValue",{}).run(["$window","$rootScope","$state","UserValue",function(t,r,e,n){t.app=function(t){r.$apply(function(){angular.extend(n,t),r.$emit("successLogin")})},r.$on("successLogin",function(){e.go("profile.rating")})}]),angular.module("mafia",["ui.router"]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(t,r,e){e.otherwise("/"),r.state("start",{url:"/",views:{header:{templateUrl:"start/startHeader/startHeader.tpl.html",controller:"StartHeaderController",controllerAs:"startHeaderCtrl"},content:{templateUrl:"common/rating/ratingContent.tpl.html",controller:"RatingController",controllerAs:"ratingCtrl"}}}).state("profile",{"abstract":!0,url:"/profile",views:{header:{templateUrl:"profile/mainHeader/mainHeader.tpl.html",controller:"MainHeaderController",controllerAs:"mainHeaderCtrl"}}}).state("profile.voting",{url:"/voting",views:{"content@":{templateUrl:"profile/voting/votingContent.tpl.html",controller:"VotingController",controllerAs:"votingCtrl"}}}).state("profile.rating",{url:"/rating",views:{"content@":{templateUrl:"common/rating/ratingContent.tpl.html",controller:"RatingController",controllerAs:"ratingCtrl"}}}).state("profile.myrating",{url:"/myrating",views:{"content@":{templateUrl:"profile/myRating/myRating.tpl.html",controller:"MyRatingController",controllerAs:"myRatingCtrl"}}}).state("admin",{url:"/admin",views:{content:{templateUrl:"admin/admin.html",controller:"AdminController"}}})}]).value("UserValue",{}).run(["$window","$rootScope","$state","UserValue",function(t,r,e,n){t.app=function(t){r.$apply(function(){angular.extend(n,t),r.$emit("successLogin")})},r.$on("successLogin",function(){e.go("profile.rating")})}]),angular.module("mafia",["ui.router"]).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(t,r,e){e.otherwise("/"),r.state("start",{url:"/",views:{header:{templateUrl:"start/startHeader/startHeader.tpl.html",controller:"StartHeaderController",controllerAs:"startHeaderCtrl"},content:{templateUrl:"common/rating/ratingContent.tpl.html",controller:"RatingController",controllerAs:"ratingCtrl"}}}).state("profile",{"abstract":!0,url:"/profile",views:{header:{templateUrl:"profile/mainHeader/mainHeader.tpl.html",controller:"MainHeaderController",controllerAs:"mainHeaderCtrl"}}}).state("profile.voting",{url:"/voting",views:{"content@":{templateUrl:"profile/voting/votingContent.tpl.html",controller:"VotingController",controllerAs:"votingCtrl"}}}).state("profile.rating",{url:"/rating",views:{"content@":{templateUrl:"common/rating/ratingContent.tpl.html",controller:"RatingController",controllerAs:"ratingCtrl"}}}).state("profile.myrating",{url:"/myrating",views:{"content@":{templateUrl:"profile/myRating/myRating.tpl.html",controller:"MyRatingController",controllerAs:"myRatingCtrl"}}}).state("admin",{url:"/admin",views:{content:{templateUrl:"admin/admin.html",controller:"AdminController"}}})}]).value("UserValue",{}).run(["$window","$rootScope","$state","UserValue",function(t,r,e,n){t.app=function(t){r.$apply(function(){angular.extend(n,t),r.$emit("successLogin")})},r.$on("successLogin",function(){e.go("profile.rating")})}]),function(){"use strict";function t(t,r,e){function n(){r._id||"start"==t.current.name||t.go("start"),e.getAllPlayers().then(function(t){a.players=t})}var a=this;n()}angular.module("mafia").controller("RatingController",t),t.$inject=["$state","UserValue","PlayersService"]}(),function(){"use strict";function t(t,r){function e(){t.go("profile.voting",r,{reload:!0})}function n(){t.go("profile.rating")}function a(){t.go("profile.myrating")}var l=this;l.goVoting=e,l.bestPlayer=n,l.myBestPlayer=a}angular.module("mafia").controller("MainHeaderController",t),t.$inject=["$state","$stateParams"]}(),function(){"use strict";function t(t,r){function e(){a.players=[],a.viewPlayers=[]}function n(){return t.get("/api/players/"+r._id).then(function(t){return _.filter(t.data,function(t){return t._id!=r._id})})}var a=this;a.getMyPlayers=n,e()}angular.module("mafia").service("MyPlayersService",t),t.$inject=["$http","UserValue"]}(),function(){"use strict";function t(t){function r(){return t.get("/api/players").then(function(t){return t.data})}var e=this;e.getAllPlayers=r}angular.module("mafia").service("PlayersService",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,r,e,n){function a(){e._id||r.go("start"),i.players=[],i.blockVoting=!1,i.array=[],n.getMyPlayers().then(function(t){i.players=t,i.array=_.shuffle(t),l()})}function l(){if(i.leftPlayer=i.array[0],i.rightPlayer=i.array[1],i.array.splice(0,2),0==i.array.length)i.array=_.shuffle(i.players);else if(1==i.array.length){var t=_.shuffle(i.players);if(i.array[0]._id==t[0]._id){var r=t[0];t[0]=t[t.length-1],t[t.length-1]=r}i.array=i.array.concat(t)}}function o(r){if(!i.blockVoting){i.blockVoting=!0;var e,n,a,o;e=i.leftPlayer.rating,n=i.rightPlayer.rating,a=i.leftPlayer.myRating,o=i.rightPlayer.myRating;var s=1/(1+Math.pow(10,(n-e)/400)),c=1/(1+Math.pow(10,(e-n)/400)),u=r?1:0,g=r?0:1,f=e>2400?10:15,y=n>2400?10:15;e=Math.floor(e+f*(u-s)),n=Math.floor(n+y*(g-c));var m=1/(1+Math.pow(10,(o-a)/400)),p=1/(1+Math.pow(10,(a-o)/400)),h=r?1:0,d=r?0:1,v=a>2400?10:15,P=o>2400?10:15;a=Math.floor(a+v*(h-m)),o=Math.floor(o+P*(d-p));var $,w;$={rating:e,myRating:a},w={rating:n,myRating:o},t.post("/api/player/"+i.leftPlayer._id,$).success(function(){t.post("/api/player/"+i.rightPlayer._id,w).success(function(){i.blockVoting=!1,l()})})}}var i=this;i.voteForPlayer=o,a()}angular.module("mafia").controller("VotingController",t),t.$inject=["$http","$state","UserValue","MyPlayersService"]}(),function(){"use strict";function t(t,r,e){function n(){r._id||"start"==t.current.name||t.go("start"),e.getMyPlayers().then(function(t){a.players=t})}var a=this;n()}angular.module("mafia").controller("MyRatingController",t),t.$inject=["$state","UserValue","MyPlayersService"]}(),function(){"use strict";function t(t){function r(){var r="/auth/vkontakte",e=1e3,n=650,a=(window.outerHeight-n)/2,l=(window.outerWidth-e)/2;t.open(r,"vkontakte_login","width="+e+",height="+n+",scrollbars=0,top="+a+",left="+l)}var e=this;e.loginVk=r}angular.module("mafia").controller("StartHeaderController",t),t.$inject=["$window"]}(),function(){"use strict";function t(t,r){function e(){a.players=[],a.viewPlayers=[]}function n(){return t.get("/api/players/"+r._id).then(function(t){return _.filter(t.data,function(t){return t._id!=r._id})})}var a=this;a.getMyPlayers=n,e()}angular.module("mafia").service("MyPlayersService",t),t.$inject=["$http","UserValue"]}(),function(){"use strict";function t(t){function r(){return t.get("/api/players").then(function(t){return t.data})}var e=this;e.getAllPlayers=r}angular.module("mafia").service("PlayersService",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,r,e){function n(){r._id||"start"==t.current.name||t.go("start"),e.getAllPlayers().then(function(t){a.players=t})}var a=this;n()}angular.module("mafia").controller("RatingController",t),t.$inject=["$state","UserValue","PlayersService"]}(),function(){"use strict";function t(t,r,e){function n(){r._id||"start"==t.current.name||t.go("start"),e.getMyPlayers().then(function(t){a.players=t})}var a=this;n()}angular.module("mafia").controller("MyRatingController",t),t.$inject=["$state","UserValue","MyPlayersService"]}(),function(){"use strict";function t(t,r){function e(){t.go("profile.voting",r,{reload:!0})}function n(){t.go("profile.rating")}function a(){t.go("profile.myrating")}var l=this;l.goVoting=e,l.bestPlayer=n,l.myBestPlayer=a}angular.module("mafia").controller("MainHeaderController",t),t.$inject=["$state","$stateParams"]}(),function(){"use strict";function t(t,r,e,n){function a(){e._id||r.go("start"),i.players=[],i.blockVoting=!1,i.array=[],n.getMyPlayers().then(function(t){i.players=t,i.array=_.shuffle(t),l()})}function l(){if(i.leftPlayer=i.array[0],i.rightPlayer=i.array[1],i.array.splice(0,2),0==i.array.length)i.array=_.shuffle(i.players);else if(1==i.array.length){var t=_.shuffle(i.players);if(i.array[0]._id==t[0]._id){var r=t[0];t[0]=t[t.length-1],t[t.length-1]=r}i.array=i.array.concat(t)}}function o(r){if(!i.blockVoting){i.blockVoting=!0;var e,n,a,o;e=i.leftPlayer.rating,n=i.rightPlayer.rating,a=i.leftPlayer.myRating,o=i.rightPlayer.myRating;var s=1/(1+Math.pow(10,(n-e)/400)),c=1/(1+Math.pow(10,(e-n)/400)),u=r?1:0,g=r?0:1,f=e>2400?10:15,y=n>2400?10:15;e=Math.floor(e+f*(u-s)),n=Math.floor(n+y*(g-c));var m=1/(1+Math.pow(10,(o-a)/400)),p=1/(1+Math.pow(10,(a-o)/400)),h=r?1:0,d=r?0:1,v=a>2400?10:15,P=o>2400?10:15;a=Math.floor(a+v*(h-m)),o=Math.floor(o+P*(d-p));var $,w;$={rating:e,myRating:a},w={rating:n,myRating:o},t.post("/api/player/"+i.leftPlayer._id,$).success(function(){t.post("/api/player/"+i.rightPlayer._id,w).success(function(){i.blockVoting=!1,l()})})}}var i=this;i.voteForPlayer=o,a()}angular.module("mafia").controller("VotingController",t),t.$inject=["$http","$state","UserValue","MyPlayersService"]}(),function(){"use strict";function t(t){function r(){var r="/auth/vkontakte",e=1e3,n=650,a=(window.outerHeight-n)/2,l=(window.outerWidth-e)/2;t.open(r,"vkontakte_login","width="+e+",height="+n+",scrollbars=0,top="+a+",left="+l)}var e=this;e.loginVk=r}angular.module("mafia").controller("StartHeaderController",t),t.$inject=["$window"]}(),function(){"use strict";function t(t,r,e){function n(){r._id||"start"==t.current.name||t.go("start"),e.getAllPlayers().then(function(t){a.players=t})}var a=this;n()}angular.module("mafia").controller("RatingController",t),t.$inject=["$state","UserValue","PlayersService"]}(),function(){"use strict";function t(t,r){function e(){a.players=[],a.viewPlayers=[]}function n(){return t.get("/api/players/"+r._id).then(function(t){return _.filter(t.data,function(t){return t._id!=r._id})})}var a=this;a.getMyPlayers=n,e()}angular.module("mafia").service("MyPlayersService",t),t.$inject=["$http","UserValue"]}(),function(){"use strict";function t(t){function r(){return t.get("/api/players").then(function(t){return t.data})}var e=this;e.getAllPlayers=r}angular.module("mafia").service("PlayersService",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,r){function e(){t.go("profile.voting",r,{reload:!0})}function n(){t.go("profile.rating")}function a(){t.go("profile.myrating")}var l=this;l.goVoting=e,l.bestPlayer=n,l.myBestPlayer=a}angular.module("mafia").controller("MainHeaderController",t),t.$inject=["$state","$stateParams"]}(),function(){"use strict";function t(t,r,e){function n(){r._id||"start"==t.current.name||t.go("start"),e.getMyPlayers().then(function(t){a.players=t})}var a=this;n()}angular.module("mafia").controller("MyRatingController",t),t.$inject=["$state","UserValue","MyPlayersService"]}(),function(){"use strict";function t(t,r,e,n){function a(){e._id||r.go("start"),i.players=[],i.blockVoting=!1,i.array=[],n.getMyPlayers().then(function(t){i.players=t,i.array=_.shuffle(t),l()})}function l(){if(i.leftPlayer=i.array[0],i.rightPlayer=i.array[1],i.array.splice(0,2),0==i.array.length)i.array=_.shuffle(i.players);else if(1==i.array.length){var t=_.shuffle(i.players);if(i.array[0]._id==t[0]._id){var r=t[0];t[0]=t[t.length-1],t[t.length-1]=r}i.array=i.array.concat(t)}}function o(r){if(!i.blockVoting){i.blockVoting=!0;var e,n,a,o;e=i.leftPlayer.rating,n=i.rightPlayer.rating,a=i.leftPlayer.myRating,o=i.rightPlayer.myRating;var s=1/(1+Math.pow(10,(n-e)/400)),c=1/(1+Math.pow(10,(e-n)/400)),u=r?1:0,g=r?0:1,f=e>2400?10:15,y=n>2400?10:15;e=Math.floor(e+f*(u-s)),n=Math.floor(n+y*(g-c));var m=1/(1+Math.pow(10,(o-a)/400)),p=1/(1+Math.pow(10,(a-o)/400)),h=r?1:0,d=r?0:1,v=a>2400?10:15,P=o>2400?10:15;a=Math.floor(a+v*(h-m)),o=Math.floor(o+P*(d-p));var $,w;$={rating:e,myRating:a},w={rating:n,myRating:o},t.post("/api/player/"+i.leftPlayer._id,$).success(function(){t.post("/api/player/"+i.rightPlayer._id,w).success(function(){i.blockVoting=!1,l()})})}}var i=this;i.voteForPlayer=o,a()}angular.module("mafia").controller("VotingController",t),t.$inject=["$http","$state","UserValue","MyPlayersService"]}(),function(){"use strict";function t(t){function r(){var r="/auth/vkontakte",e=1e3,n=650,a=(window.outerHeight-n)/2,l=(window.outerWidth-e)/2;t.open(r,"vkontakte_login","width="+e+",height="+n+",scrollbars=0,top="+a+",left="+l)}var e=this;e.loginVk=r}angular.module("mafia").controller("StartHeaderController",t),t.$inject=["$window"]}(),function(){"use strict";function t(t,r,e){function n(){r._id||"start"==t.current.name||t.go("start"),e.getAllPlayers().then(function(t){a.players=t})}var a=this;n()}angular.module("mafia").controller("RatingController",t),t.$inject=["$state","UserValue","PlayersService"]}(),function(){"use strict";function t(t,r){function e(){a.players=[],a.viewPlayers=[]}function n(){return t.get("/api/players/"+r._id).then(function(t){return _.filter(t.data,function(t){return t._id!=r._id})})}var a=this;a.getMyPlayers=n,e()}angular.module("mafia").service("MyPlayersService",t),t.$inject=["$http","UserValue"]}(),function(){"use strict";function t(t){function r(){return t.get("/api/players").then(function(t){return t.data})}var e=this;e.getAllPlayers=r}angular.module("mafia").service("PlayersService",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,r){function e(){t.go("profile.voting",r,{reload:!0})}function n(){t.go("profile.rating")}function a(){t.go("profile.myrating")}var l=this;l.goVoting=e,l.bestPlayer=n,l.myBestPlayer=a}angular.module("mafia").controller("MainHeaderController",t),t.$inject=["$state","$stateParams"]}(),function(){"use strict";function t(t,r,e){function n(){r._id||"start"==t.current.name||t.go("start"),e.getMyPlayers().then(function(t){a.players=t})}var a=this;n()}angular.module("mafia").controller("MyRatingController",t),t.$inject=["$state","UserValue","MyPlayersService"]}(),function(){"use strict";function t(t,r,e,n){function a(){e._id||r.go("start"),i.players=[],i.blockVoting=!1,i.array=[],n.getMyPlayers().then(function(t){i.players=t,i.array=_.shuffle(t),l()})}function l(){if(i.leftPlayer=i.array[0],i.rightPlayer=i.array[1],i.array.splice(0,2),0==i.array.length)i.array=_.shuffle(i.players);else if(1==i.array.length){var t=_.shuffle(i.players);if(i.array[0]._id==t[0]._id){var r=t[0];t[0]=t[t.length-1],t[t.length-1]=r}i.array=i.array.concat(t)}}function o(r){if(!i.blockVoting){i.blockVoting=!0;var e,n,a,o;e=i.leftPlayer.rating,n=i.rightPlayer.rating,a=i.leftPlayer.myRating,o=i.rightPlayer.myRating;var s=1/(1+Math.pow(10,(n-e)/400)),c=1/(1+Math.pow(10,(e-n)/400)),u=r?1:0,g=r?0:1,f=e>2400?10:15,y=n>2400?10:15;e=Math.floor(e+f*(u-s)),n=Math.floor(n+y*(g-c));var m=1/(1+Math.pow(10,(o-a)/400)),p=1/(1+Math.pow(10,(a-o)/400)),h=r?1:0,d=r?0:1,v=a>2400?10:15,P=o>2400?10:15;a=Math.floor(a+v*(h-m)),o=Math.floor(o+P*(d-p));var $,w;$={rating:e,myRating:a},w={rating:n,myRating:o},t.post("/api/player/"+i.leftPlayer._id,$).success(function(){t.post("/api/player/"+i.rightPlayer._id,w).success(function(){i.blockVoting=!1,l()})})}}var i=this;i.voteForPlayer=o,a()}angular.module("mafia").controller("VotingController",t),t.$inject=["$http","$state","UserValue","MyPlayersService"]}(),function(){"use strict";function t(t){function r(){var r="/auth/vkontakte",e=1e3,n=650,a=(window.outerHeight-n)/2,l=(window.outerWidth-e)/2;t.open(r,"vkontakte_login","width="+e+",height="+n+",scrollbars=0,top="+a+",left="+l)}var e=this;e.loginVk=r}angular.module("mafia").controller("StartHeaderController",t),t.$inject=["$window"]}(),function(){"use strict";function t(t,r){function e(){a.players=[],a.viewPlayers=[]}function n(){return t.get("/api/players/"+r._id).then(function(t){return _.filter(t.data,function(t){return t._id!=r._id})})}var a=this;a.getMyPlayers=n,e()}angular.module("mafia").service("MyPlayersService",t),t.$inject=["$http","UserValue"]}(),function(){"use strict";function t(t){function r(){return t.get("/api/players").then(function(t){return t.data})}var e=this;e.getAllPlayers=r}angular.module("mafia").service("PlayersService",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,r,e){function n(){r._id||"start"==t.current.name||t.go("start"),e.getAllPlayers().then(function(t){a.players=t})}var a=this;n()}angular.module("mafia").controller("RatingController",t),t.$inject=["$state","UserValue","PlayersService"]}(),function(){"use strict";function t(t,r){function e(){t.go("profile.voting",r,{reload:!0})}function n(){t.go("profile.rating")}function a(){t.go("profile.myrating")}var l=this;l.goVoting=e,l.bestPlayer=n,l.myBestPlayer=a}angular.module("mafia").controller("MainHeaderController",t),t.$inject=["$state","$stateParams"]}(),function(){"use strict";function t(t,r,e){function n(){r._id||"start"==t.current.name||t.go("start"),e.getMyPlayers().then(function(t){a.players=t})}var a=this;n()}angular.module("mafia").controller("MyRatingController",t),t.$inject=["$state","UserValue","MyPlayersService"]}(),function(){"use strict";function t(t){function r(){var r="/auth/vkontakte",e=1e3,n=650,a=(window.outerHeight-n)/2,l=(window.outerWidth-e)/2;t.open(r,"vkontakte_login","width="+e+",height="+n+",scrollbars=0,top="+a+",left="+l)}var e=this;e.loginVk=r}angular.module("mafia").controller("StartHeaderController",t),t.$inject=["$window"]}(),function(){"use strict";function t(t,r,e,n){function a(){e._id||r.go("start"),i.players=[],i.blockVoting=!1,i.array=[],n.getMyPlayers().then(function(t){i.players=t,i.array=_.shuffle(t),l()})}function l(){if(i.leftPlayer=i.array[0],i.rightPlayer=i.array[1],i.array.splice(0,2),0==i.array.length)i.array=_.shuffle(i.players);else if(1==i.array.length){var t=_.shuffle(i.players);if(i.array[0]._id==t[0]._id){var r=t[0];t[0]=t[t.length-1],t[t.length-1]=r}i.array=i.array.concat(t)}}function o(r){if(!i.blockVoting){i.blockVoting=!0;var e,n,a,o;e=i.leftPlayer.rating,n=i.rightPlayer.rating,a=i.leftPlayer.myRating,o=i.rightPlayer.myRating;var s=1/(1+Math.pow(10,(n-e)/400)),c=1/(1+Math.pow(10,(e-n)/400)),u=r?1:0,g=r?0:1,f=e>2400?10:15,y=n>2400?10:15;e=Math.floor(e+f*(u-s)),n=Math.floor(n+y*(g-c));var m=1/(1+Math.pow(10,(o-a)/400)),p=1/(1+Math.pow(10,(a-o)/400)),h=r?1:0,d=r?0:1,v=a>2400?10:15,P=o>2400?10:15;a=Math.floor(a+v*(h-m)),o=Math.floor(o+P*(d-p));var $,w;$={rating:e,myRating:a},w={rating:n,myRating:o},t.post("/api/player/"+i.leftPlayer._id,$).success(function(){t.post("/api/player/"+i.rightPlayer._id,w).success(function(){i.blockVoting=!1,l()})})}}var i=this;i.voteForPlayer=o,a()}angular.module("mafia").controller("VotingController",t),t.$inject=["$http","$state","UserValue","MyPlayersService"]}(),function(){"use strict";function t(t,r){function e(){t.go("profile.voting",r,{reload:!0})}function n(){t.go("profile.rating")}function a(){t.go("profile.myrating")}var l=this;l.goVoting=e,l.bestPlayer=n,l.myBestPlayer=a}angular.module("mafia").controller("MainHeaderController",t),t.$inject=["$state","$stateParams"]}(),function(){"use strict";function t(t,r,e){function n(){r._id||"start"==t.current.name||t.go("start"),e.getMyPlayers().then(function(t){a.players=t})}var a=this;n()}angular.module("mafia").controller("MyRatingController",t),t.$inject=["$state","UserValue","MyPlayersService"]}(),function(){"use strict";function t(t,r,e,n){function a(){e._id||r.go("start"),i.players=[],i.blockVoting=!1,i.array=[],n.getMyPlayers().then(function(t){i.players=t,i.array=_.shuffle(t),l()})}function l(){if(i.leftPlayer=i.array[0],i.rightPlayer=i.array[1],i.array.splice(0,2),0==i.array.length)i.array=_.shuffle(i.players);else if(1==i.array.length){var t=_.shuffle(i.players);if(i.array[0]._id==t[0]._id){var r=t[0];t[0]=t[t.length-1],t[t.length-1]=r}i.array=i.array.concat(t)}}function o(r){if(!i.blockVoting){i.blockVoting=!0;var e,n,a,o;e=i.leftPlayer.rating,n=i.rightPlayer.rating,a=i.leftPlayer.myRating,o=i.rightPlayer.myRating;var s=1/(1+Math.pow(10,(n-e)/400)),c=1/(1+Math.pow(10,(e-n)/400)),u=r?1:0,g=r?0:1,f=e>2400?10:15,y=n>2400?10:15;e=Math.floor(e+f*(u-s)),n=Math.floor(n+y*(g-c));var m=1/(1+Math.pow(10,(o-a)/400)),p=1/(1+Math.pow(10,(a-o)/400)),h=r?1:0,d=r?0:1,v=a>2400?10:15,P=o>2400?10:15;a=Math.floor(a+v*(h-m)),o=Math.floor(o+P*(d-p));var $,w;$={rating:e,myRating:a},w={rating:n,myRating:o},t.post("/api/player/"+i.leftPlayer._id,$).success(function(){t.post("/api/player/"+i.rightPlayer._id,w).success(function(){i.blockVoting=!1,l()})})}}var i=this;i.voteForPlayer=o,a()}angular.module("mafia").controller("VotingController",t),t.$inject=["$http","$state","UserValue","MyPlayersService"]}(),function(){"use strict";function t(t,r,e){function n(){r._id||"start"==t.current.name||t.go("start"),e.getAllPlayers().then(function(t){a.players=t})}var a=this;n()}angular.module("mafia").controller("RatingController",t),t.$inject=["$state","UserValue","PlayersService"]}(),function(){"use strict";function t(t,r){function e(){a.players=[],a.viewPlayers=[]}function n(){return t.get("/api/players/"+r._id).then(function(t){return _.filter(t.data,function(t){return t._id!=r._id})})}var a=this;a.getMyPlayers=n,e()}angular.module("mafia").service("MyPlayersService",t),t.$inject=["$http","UserValue"]}(),function(){"use strict";function t(t){function r(){return t.get("/api/players").then(function(t){return t.data})}var e=this;e.getAllPlayers=r}angular.module("mafia").service("PlayersService",t),t.$inject=["$http"]}(),function(){"use strict";function t(t){function r(){var r="/auth/vkontakte",e=1e3,n=650,a=(window.outerHeight-n)/2,l=(window.outerWidth-e)/2;t.open(r,"vkontakte_login","width="+e+",height="+n+",scrollbars=0,top="+a+",left="+l)}var e=this;e.loginVk=r}angular.module("mafia").controller("StartHeaderController",t),t.$inject=["$window"]}(),function(){"use strict";function t(t,r,e){function n(){r._id||"start"==t.current.name||t.go("start"),e.getAllPlayers().then(function(t){a.players=t})}var a=this;n()}angular.module("mafia").controller("RatingController",t),t.$inject=["$state","UserValue","PlayersService"]}(),function(){"use strict";function t(t,r){function e(){a.players=[],a.viewPlayers=[]}function n(){return t.get("/api/players/"+r._id).then(function(t){return _.filter(t.data,function(t){return t._id!=r._id})})}var a=this;a.getMyPlayers=n,e()}angular.module("mafia").service("MyPlayersService",t),t.$inject=["$http","UserValue"]}(),function(){"use strict";function t(t){function r(){return t.get("/api/players").then(function(t){return t.data})}var e=this;e.getAllPlayers=r}angular.module("mafia").service("PlayersService",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,r,e){function n(){r._id||"start"==t.current.name||t.go("start"),e.getMyPlayers().then(function(t){a.players=t})}var a=this;n()}angular.module("mafia").controller("MyRatingController",t),t.$inject=["$state","UserValue","MyPlayersService"]}(),function(){"use strict";function t(t,r){function e(){t.go("profile.voting",r,{reload:!0})}function n(){t.go("profile.rating")}function a(){t.go("profile.myrating")}var l=this;l.goVoting=e,l.bestPlayer=n,l.myBestPlayer=a}angular.module("mafia").controller("MainHeaderController",t),t.$inject=["$state","$stateParams"]}(),function(){"use strict";function t(t,r,e,n){function a(){e._id||r.go("start"),i.players=[],i.blockVoting=!1,i.array=[],n.getMyPlayers().then(function(t){i.players=t,i.array=_.shuffle(t),l()})}function l(){if(i.leftPlayer=i.array[0],i.rightPlayer=i.array[1],i.array.splice(0,2),0==i.array.length)i.array=_.shuffle(i.players);else if(1==i.array.length){var t=_.shuffle(i.players);if(i.array[0]._id==t[0]._id){var r=t[0];t[0]=t[t.length-1],t[t.length-1]=r}i.array=i.array.concat(t)}}function o(r){if(!i.blockVoting){i.blockVoting=!0;var e,n,a,o;e=i.leftPlayer.rating,n=i.rightPlayer.rating,a=i.leftPlayer.myRating,o=i.rightPlayer.myRating;var s=1/(1+Math.pow(10,(n-e)/400)),c=1/(1+Math.pow(10,(e-n)/400)),u=r?1:0,g=r?0:1,f=e>2400?10:15,y=n>2400?10:15;e=Math.floor(e+f*(u-s)),n=Math.floor(n+y*(g-c));var m=1/(1+Math.pow(10,(o-a)/400)),p=1/(1+Math.pow(10,(a-o)/400)),h=r?1:0,d=r?0:1,v=a>2400?10:15,P=o>2400?10:15;a=Math.floor(a+v*(h-m)),o=Math.floor(o+P*(d-p));var $,w;$={rating:e,myRating:a},w={rating:n,myRating:o},t.post("/api/player/"+i.leftPlayer._id,$).success(function(){t.post("/api/player/"+i.rightPlayer._id,w).success(function(){i.blockVoting=!1,l()})})}}var i=this;i.voteForPlayer=o,a()}angular.module("mafia").controller("VotingController",t),t.$inject=["$http","$state","UserValue","MyPlayersService"]}(),function(){"use strict";function t(t){function r(){var r="/auth/vkontakte",e=1e3,n=650,a=(window.outerHeight-n)/2,l=(window.outerWidth-e)/2;t.open(r,"vkontakte_login","width="+e+",height="+n+",scrollbars=0,top="+a+",left="+l)}var e=this;e.loginVk=r}angular.module("mafia").controller("StartHeaderController",t),t.$inject=["$window"]}();